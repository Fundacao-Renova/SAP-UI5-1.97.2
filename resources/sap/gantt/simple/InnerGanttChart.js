/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/core/Control","sap/ui/table/library","sap/ui/table/utils/TableUtils","sap/gantt/simple/GanttExtension","sap/gantt/simple/InnerGanttChartRenderer"],function(C,a,t,T,G){"use strict";var I=a.extend("sap.gantt.simple.InnerGanttChart",{metadata:{library:"sap.gantt",events:{ganttReady:{parameters:{hasRenderedShapes:{type:"boolean"},totalRenderedShapes:{type:"int"}}},_afterGanttRendered:{}}}});I.prototype.getDomRef=function(s){var p=this.getParent(),d;if(s){d="-"+s;}else{d="-cnt";}if(p){return window.document.getElementById(p.getId()+d);}return null;};I.prototype.invalidate=function(){var g=this.getParent();g._oInnerGanttRenderPromise.then(function(){var u=this.getUIArea();if(u){u.addInvalidatedControl(this);}}.bind(this));};I.prototype.hasRenderedShapes=function(){return this.$("svg").find(".sapGanttChartShapes").children().length>0;};I.prototype.getTotalRenderedShapes=function(){return this.$("svg").find(".sapGanttChartShapes").children().length;};I.prototype.resolveWhenReady=function(w){return new Promise(function(r){var h=function b(e){var g=this.getParent();if(g._enableOptimisation){g.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);}if(w&&!e.getParameter("hasRenderedShapes")||(g.getTable().getVisibleRowCountMode()===t.VisibleRowCountMode.Auto&&g.getSyncedControl().getRowStates().length<(g.getTable().getVisibleRowCount()+T.getHeaderRowCount(g.getTable())))){this.attachEventOnce("ganttReady",h);}else{r();}}.bind(this);var i=Object.keys(this.getUIArea().mInvalidatedControls);if(i.indexOf(this.getParent().getId())>-1||i.indexOf(this.getParent().getTable().getId())>-1){this.attachEventOnce("ganttReady",h);}else if((!w&&this.getDomRef("svg"))||(w&&this.hasRenderedShapes())){r();}else{this.attachEventOnce("ganttReady",h);}}.bind(this));};I.prototype._updateRowsHoverState=function(){var g=this.getParent();setTimeout(function(){g.$("svg").find("rect.sapGanttBackgroundSVGRow:hover").each(function(){var e=g._getPointerExtension(),i=e._getRowIndexFromElement(this);g.getSyncedControl().syncRowHover(i,true);});g.$("svg").find("rect.sapGanttBackgroundSVGRow:not(:hover)").each(function(){var e=g._getPointerExtension(),i=e._getRowIndexFromElement(this);g.getSyncedControl().syncRowHover(i,false);});},0);};I.prototype.onBeforeRendering=function(e){if(!this.getParent()._bPreventInitialRender||this.getParent()._bRenderGanttClone||this.getParent()._bRenderFullScreenGantt){this.getParent()._bRenderFullScreenGantt=false;this.getParent()._getScrollExtension().jumpToVisibleHorizon("initialRender");}};I.prototype.onAfterRendering=function(e){var g=this.getParent();g._updateVsbContainers();g._syncContainerGanttCharts("initialRender",e);var r=C.createRenderManager();this.getRenderer().renderRelationships(r,g);r.destroy();this.fireEvent("_afterGanttRendered");g._updateShapeSelections(g.getSelectedShapeUid(),[]);g._getConnectExtension().updateShapeConnectEffect(g);this._updateRowsHoverState();G.attachEvents(g);this.fireGanttReady({hasRenderedShapes:this.hasRenderedShapes(),totalRenderedShapes:this.getTotalRenderedShapes()});};return I;},true);
